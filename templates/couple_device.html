{% extends "base.html" %}

{% block title %}Devices{% endblock %}

{% block content %}
<h2>Couple a Device</h2>
    
{% if success %}
    <div class="alert alert-success">{{ success }}</div>
{% elif error %}
    <div class="alert alert-danger">{{ error }}</div>
{% endif %}

<ul id="device-list">
    <!-- Devices will be dynamically added here -->
</ul>

    <script>
        // Function to fetch device statuses from the Flask backend
        function fetchDeviceStatuses() {
            fetch("/devices/status")  // Call the Flask route
                .then(response => response.json())
                .then(data => {
                    if (Array.isArray(data) && data.length > 0) {
                        // Successfully received device data, update the UI
                        const deviceList = document.getElementById("device-list");
                        deviceList.innerHTML = ''; // Clear previous list
                        data.forEach(device => {
                            const deviceItem = document.createElement("li");
                            deviceItem.textContent = `Device ID: ${device.device_id}, Status: ${device.status}`;
                            deviceList.appendChild(deviceItem);
                        });
                    } else {
                        // No devices or error in the response
                        const deviceList = document.getElementById("device-list");
                        deviceList.innerHTML = '<li>No devices available</li>';
                    }
                })
                .catch(error => {
                    console.error("Error fetching device statuses:", error);
                    const deviceList = document.getElementById("device-list");
                    deviceList.innerHTML = '<li>An error occurred while fetching device statuses</li>';
                });
        }
    
        // Fetch device statuses on page load
        document.addEventListener("DOMContentLoaded", fetchDeviceStatuses);
    </script>
{% endblock %}
